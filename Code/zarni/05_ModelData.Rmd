---
title: "R Notebook"
output:
  html_notebook: default
  pdf_document: default
---
Libraries

```{r, warning = FALSE}
library(readxl)
library(data.table)
library(lubridate) #Date Time Object
library(ggplot2)
library(stringr) #Regular expression string splitting
library(rio)
library(MASS)
library(tigris)
library(sp)
library(broom)
library(dplyr)
library(rgdal)
library(stargazer)
```

T21 External Raw Data 
```{r}
T21External <- import("../../Data/MACTownHealth21_v6.csv")
View(T21External)
```

Remove the 2 cases and remove the years before 2009 and removing 2018 (Data needs to be reformatted again)
```{r}
T21ExtSub <- T21External[T21External$Event != 2, ]
T21ExtSub <- T21ExtSub[-1]
T21ExtSub <- subset(T21ExtSub, Year > 2010)
T21ExtSub <- subset(T21ExtSub, Year < 2018)
View(T21ExtSub)

write.csv(T21ExtSub, "../../Data/T21ExtSub.csv")
View(T21ExtSub)
```

All T21 Imports

```{r}
AllT21TopRatios <- import("../../Data/AllT21TopRatios.csv")
View(AllT21TopRatios)
AllT21TopRatios <- AllT21TopRatios[-1]
View(AllT21TopRatios)
```

Merging the data file
```{r}
T21Merged <- T21ExtSub %>% left_join(AllT21TopRatios, by = c("Name" ="CityTown", "Year" = "year"))
```

```{r}
names(T21Merged) <- gsub(" ","",names(T21Merged))
```

```{r}
str(T21Merged)
T21Merged$Population <- as.numeric (T21Merged$Population)
write.csv(T21Merged, "../../Data/T21Mergedsecondattempt.csv")
```

```{r}
demo <- import("../../Data/T21Mergedsecondattempt.csv")
View(demo)
dim(demo)
```



```{r}
T21Merged$Event <- as.numeric(T21Merged$Event)
```



Logit Model
```{r}
logitmodel <- glm(Event ~  Population + NearbyT21Ratio + PhysicallyUnhealthyDays + MentallyUnhealthyDays + PercentSmokers + PercentExcessiveDrinking + TeenBirthRate + ChlamydiaRate + PercentUnemployed + ViolentCrimeRate   , family = binomial(link = "logit"), data = T21Merged )

summary(logitmodel)
```

Table format
```{r}
stargazer(logitmodel, type = "text")

```

